<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            display: flex;
            margin: 0;
            font-family: 'Cairo', sans-serif;
            background: #f8f9fa;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            width: 280px;
            background: #002b5c;
            color: white;
            padding: 20px;
            height: 99vh;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        .sidebar h2 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 25px;
            border-bottom: 2px solid #f4cc04;
            padding-bottom: 10px;
        }
        .section {
            padding: 15px;
            background: #004085;
            margin-bottom: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.3s ease;
            font-size: 18px;
            font-weight: bold;
        }
        .section:hover {
            background: #0056b3;
        }
        .profile-container {
            position: absolute;
            top: 15px;
            left: 15px;
            text-align: center;
        }
        .profile-pic {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #0056b3;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .profile-pic:active {
            transform: scale(0.9);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .dropdown {
            display: none;
            position: absolute;
            left: 0;
            top: 60px;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            overflow: hidden;
            min-width: 180px;
            z-index: 10;
        }
        .dropdown button {
            width: 100%;
            padding: 12px;
            border: none;
            background: white;
            cursor: pointer;
            text-align: right;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s ease;
        }
        .dropdown button:hover {
            background: #f4cc04;
        }
        .content {
            flex-grow: 1;
            padding: 20px;
            background: #ffffff;
            overflow: hidden;
            height: 100vh;
            /* Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø§Ù„Ø®Ù„ÙÙŠØ© */
            
        }
        iframe {
    width: 100%;
    height: 100%;
    border: none;
    display: none;
}


        /* âœ… Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        .popup-content {
            background: white;
            width: 350px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        .popup-content img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #004085;
        }
        .popup-content h3 {
            margin-top: 10px;
            color: #004085;
        }
        .popup-content p {
            margin: 5px 0;
            font-size: 16px;
        }
        .popup-content button {
            margin-top: 15px;
            padding: 10px;
            width: 100%;
            border: none;
            background: #dc3545;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .popup-content button:hover {
            background: #c82333;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 22px;
            cursor: pointer;
            color: #004085;
        }
        .main-content {
    flex-grow: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 5px;
    background: white;
    height: 100vh;
}

.main-content img {
    width: 600px; /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¹Ø§Ø± */
    height: 600px; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± */
    opacity: 0.5;
    display: block;
    margin: auto;
}


    </style>
</head>
<body>

    
    <div class="sidebar">
        <h2>Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h2>
        <div class="section" onclick="loadPage('agaza.html')">Ø·Ù„Ø¨ Ø§Ø¬Ø§Ø²Ø©</div>
        <div class="section" onclick="loadPage('tchfed.html')">Ø·Ù„Ø¨ ØªØ®ÙÙŠØ¶ Ø§Ù„Ù‚Ø³Ø·</div>
        <div class="section" onclick="loadPage('thoel.php')">Ø·Ù„Ø¨ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</div>
        <div class="section" onclick="loadPage('jzdd.php')">Ø·Ù„Ø¨ ØªØ§ÙŠÙŠØ¯ Ø§Ù„Ù‰ Ø¬Ù‡Ù‡ Ù…Ø¹ÙŠÙ†Ø©</div>
        <div class="section" onclick="loadPage('TLPAT.php')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>

    </div>

    <div class="content">
        <div class="main-content" id="logoContainer">
            <img src="muclogo-01.svg" alt="Ø§Ù„Ø´Ø¹Ø§Ø±">
        </div>
        <iframe id="contentIframe" src="" title="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¯Ù…Ø©"></iframe>
    </div>
    <div class="profile-container">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div id="notificationButton" style="cursor: pointer; font-size: 20px; position: relative;">
                ğŸ””
                <span id="notificationCount" style="color: red; font-weight: bold; background: white; border-radius: 50%; padding: 2px 6px; font-size: 14px; display: none; position: absolute; top: -5px; right: -5px;">0</span>
            </div>
        <img id="profileImage" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" class="profile-pic" onclick="toggleDropdown(event)">
        <div class="dropdown" id="profileDropdown">
            <button onclick="viewProfile()">ğŸ‘¤ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
            <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <!-- âœ… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div class="popup-overlay" id="profilePopup">
        <div class="popup-content">
            <span class="close-btn" onclick="closeProfilePopup()">Ã—</span>
            <img id="profileImage1" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" class="profile-pic" onclick="toggleDropdown(event)">
            <h3 id="popup-name">Ø§Ù„Ø§Ø³Ù…: ...</h3>
            <p id="popup-id">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ: ...</p>
            <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>
 
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const studentName = urlParams.get('student_name');
        const studentId = urlParams.get('student_id');
        if (studentId) {
    document.getElementById("profileImage").src = `display_image.php?student_id=${encodeURIComponent(studentId)}`;
} else {
    document.getElementById("profileImage").src = "default_profile.jpg"; // ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
}
if (studentId) {
    document.getElementById("profileImage1").src = `display_image.php?student_id=${encodeURIComponent(studentId)}`;
} else {
    document.getElementById("profileImage1").src = "default_profile.jpg"; // ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
}
        if (studentName && studentId) {
            document.getElementById('popup-name').textContent = "Ø§Ù„Ø§Ø³Ù…: " + studentName;
            document.getElementById('popup-id').textContent = "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ: " + studentId;
        }

        function toggleDropdown(event) {
            let dropdown = document.getElementById("profileDropdown");
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
            event.stopPropagation();
        }

        function viewProfile() {
            document.getElementById("profilePopup").style.display = "flex";
        }

        function closeProfilePopup() {
            document.getElementById("profilePopup").style.display = "none";
        }

        function logout() {
            window.location.href = "login.php";
        }
        const contentUrl = 'agaza.html'; // Ø§Ø³Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰

        function loadPage(pageId) {
            document.getElementById('contentIframe').src = `https://${domain}.${contentUrl}`;
        }

        function handleDropdownClick(button, dropdown) {
            if (button.target === dropdown) {
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
        }
        
        function loadPage(page) {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø¹Ø§Ø±
    document.getElementById('logoContainer').style.display = 'none';
    // Ø¥Ø¸Ù‡Ø§Ø± iframe
    document.getElementById('contentIframe').style.display = 'block';
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ studentName Ùˆ studentId
    if (studentName && studentId) {
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·
        document.getElementById('contentIframe').src = `${page}?student_name=${encodeURIComponent(studentName)}&student_id=${encodeURIComponent(studentId)}`;
    } else {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ù„Ù…Ø§Øª
        document.getElementById('contentIframe').src = page;
    }
}


// Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø¬Ø§Ù†Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
const profileContainer = document.querySelector('.profile-container');
const notificationButton = document.createElement('div');
notificationButton.style.display = 'flex';
notificationButton.style.alignItems = 'center';
notificationButton.style.marginRight = '10px';
notificationButton.style.position = 'absolute';
notificationButton.style.top = '50%';
notificationButton.style.right = '60px';
notificationButton.style.transform = 'translateY(-50%)';
notificationButton.style.cursor = 'pointer';
notificationButton.style.fontSize = '20px';
notificationButton.onclick = showNotifications;
profileContainer.appendChild(notificationButton);

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ
let lastNotificationCount = 0; // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚

function checkForUpdates() {
    fetch('check_notifications.php?student_number=' + encodeURIComponent(studentId))
        .then(response => response.json())
        .then(data => {
            const notificationCount = document.getElementById('notificationCount');
            if (data.new_notifications && data.new_notifications > 0) {
                if (data.new_notifications !== lastNotificationCount) { 
                    notificationCount.textContent = data.new_notifications;
                    notificationCount.style.display = 'inline';
                    showNotificationAlert(); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙˆØªÙŠ ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±
                }
            } else {
                notificationCount.style.display = 'none';
            }
            lastNotificationCount = data.new_notifications || 0; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®ÙŠØ±
        })
        .catch(error => console.error('Error fetching notifications:', error));
}


function showNotifications() {
    loadPage('TLPAT.php');

    // ØªØµÙÙŠØ± status_updated Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    fetch('clear_status_updates.php?student_number=' + encodeURIComponent(studentId))
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('notificationCount').style.display = 'none';
            }
        })
        .catch(error => console.error('Error clearing notifications:', error));
}


// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ ØµÙˆØªÙŠ ÙˆÙ…Ø±Ø¦ÙŠ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯

function showNotificationAlert() {
    const audio = new Audio('notification.mp3'); // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù
    audio.play(); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
    notificationButton.style.animation = 'shake 0.5s'; // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ØµØ±ÙŠ
    setTimeout(() => { notificationButton.style.animation = ''; }, 500);
}
setInterval(checkForUpdates, 5000);

// Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
const style = document.createElement('style');
style.innerHTML = `
@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}`;
document.head.appendChild(style);

        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            let dropdown = document.getElementById("profileDropdown");
            let profilePic = document.querySelector(".profile-pic");
            let profilePopup = document.getElementById("profilePopup");

            if (event.target !== profilePic && !profilePic.contains(event.target)) {
                dropdown.style.display = "none";
            }

            if (event.target === profilePopup) {
                closeProfilePopup();
            }
        });

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        document.getElementById("profilePopup").addEventListener('click', function(event) {
            if (event.target === this) {
                closeProfilePopup();
            }
        });
    </script>

</body>
</html>
